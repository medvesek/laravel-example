services:
    app:
        image: ghcr.io/medvesek/laravel-example:latest
        env_file: .env
        networks:
            - traefik-net
        deploy:
            replicas: 1
            update_config:
                order: start-first
                parallelism: 1
                delay: 15s
            labels:
                - "traefik.enable=true"
                - "traefik.http.routers.laravel_example.rule=Host(`laravel-example.ajmuht.eu`)"
                - "traefik.http.routers.laravel_example.entrypoints=websecure"
                - "traefik.http.routers.laravel_example.tls.certresolver=le"
                - "traefik.http.services.laravel_example.loadbalancer.server.port=80"
    postgres:
        image: postgres:17
        volumes:
            - postgresdata:/var/lib/postgresql/data
        environment:
            POSTGRES_PASSWORD: ${DB_PASSWORD}
            POSTGRES_USER: ${DB_USERNAME}
            POSTGRES_DB: ${DB_DATABASE}

networks:
    traefik-net:
        external: true

volumes:
    postgresdata:
